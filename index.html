<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cyber Zamboni: Pro-Classic</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        body { margin: 0; background: #020205; font-family: 'Orbitron', sans-serif; color: white; overflow: hidden; }
        
        #menu-layer { 
            position: absolute; width: 100%; height: 100%; z-index: 100; 
            background: radial-gradient(circle, #0a0a25 0%, #000 100%); 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
        }
        
        .main-title { font-size: 50px; color: #00ffff; text-shadow: 0 0 20px #00ffff; margin-bottom: 20px; font-weight: 900; }
        .menu-options { display: flex; flex-direction: column; gap: 12px; width: 340px; }
        
        .btn { 
            background: rgba(0, 255, 255, 0.05); border: 2px solid #00ffff; color: #00ffff; 
            padding: 16px; cursor: pointer; font-family: 'Orbitron'; font-weight: 700; 
            transition: 0.3s; text-transform: uppercase; text-align: center; font-size: 14px;
        }
        .btn:hover { background: #00ffff; color: #000; box-shadow: 0 0 30px #00ffff; }

        #garage-overlay { 
            display: none; position: absolute; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.95); z-index: 110; flex-direction: column; 
            align-items: center; justify-content: center; 
        }
        .skin-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 20px; }
        .skin-item { 
            border: 2px solid #333; padding: 20px; width: 160px; text-align: center; 
            cursor: pointer; background: #111; transition: 0.2s;
        }
        .skin-item.locked { opacity: 0.4; border-color: #ff0055; cursor: not-allowed; }
        .skin-item.selected { border-color: #00ff00; background: rgba(0,255,0,0.1); }
        
        #game-container { width: 100vw; height: 100vh; display: none; }
    </style>
</head>
<body>

    <div id="menu-layer">
        <div class="main-title">CYBER ZAMBONI</div>
        <div style="margin-bottom: 20px; letter-spacing: 3px;">BEST: <span id="hi-val-display">0</span></div>
        <div class="menu-options">
            <div class="btn" onclick="startGame('story')">Story Mode</div>
            <div class="btn" onclick="startGame('endless')">Endless Mode</div>
            <div class="btn" onclick="startGame('comp')">Competitive Mode</div>
            <div class="btn" onclick="toggleGarage(true)">Customize Tab</div>
        </div>
    </div>

    <div id="garage-overlay">
        <h1 style="color:#00ffff; font-weight:900;">GARAGE</h1>
        <div class="skin-grid" id="skin-list"></div>
        <div class="btn" style="margin-top: 40px; width: 220px;" onclick="toggleGarage(false)">BACK TO MENU</div>
    </div>

    <div id="game-container"></div>

    <script>
        let gameState = JSON.parse(localStorage.getItem('zamboni_save_v3')) || { hi: 0, skin: 'standard' };
        let activeMode = 'endless';

        const SKINS = [
            { id: 'standard', name: 'Classic Red', color: '#ff0000', req: 0 },
            { id: 'neon', name: 'Neon Blue', color: '#00ffff', req: 0 },
            { id: 'mario', name: 'Mario/Luigi', color: '#ff3333', req: 500 },
            { id: 'lambo', name: 'Lambo-Z', color: '#ffcc00', req: 1000 }
        ];

        function toggleGarage(show) {
            const g = document.getElementById('garage-overlay');
            g.style.display = show ? 'flex' : 'none';
            if(show) renderSkins();
        }

        function renderSkins() {
            const list = document.getElementById('skin-list');
            list.innerHTML = '';
            document.getElementById('hi-val-display').innerText = gameState.hi;
            
            SKINS.forEach(s => {
                const isLocked = gameState.hi < s.req;
                const div = document.createElement('div');
                div.className = `skin-item ${isLocked ? 'locked' : ''} ${gameState.skin === s.id ? 'selected' : ''}`;
                div.innerHTML = `<strong>${s.name}</strong><br><small>${isLocked ? 'LOCKED ('+s.req+')' : 'AVAILABLE'}</small>`;
                if(!isLocked) {
                    div.onclick = () => { gameState.skin = s.id; save(); renderSkins(); };
                }
                list.appendChild(div);
            });
        }

        function save() { localStorage.setItem('zamboni_save_v3', JSON.stringify(gameState)); }

        function startGame(mode) {
            activeMode = mode;
            document.getElementById('menu-layer').style.display = 'none';
            document.getElementById('game-container').style.display = 'block';
            initPhaser();
        }

        function initPhaser() {
            const config = {
                type: Phaser.AUTO,
                width: window.innerWidth,
                height: window.innerHeight,
                parent: 'game-container',
                physics: { default: 'arcade', arcade: { gravity: { y: 0 } } },
                scene: { preload, create, update }
            };
            new Phaser.Game(config);
        }

        function preload() {
            // Generate Zamboni Textures based on Garage Selection
            SKINS.forEach(s => {
                let canvas = this.textures.createCanvas('z_' + s.id, 64, 40);
                let ctx = canvas.context;
                ctx.fillStyle = s.color;
                ctx.fillRect(5, 5, 54, 30);
                ctx.fillStyle = '#111';
                ctx.fillRect(45, 0, 10, 10); ctx.fillRect(45, 30, 10, 10); // Tires
                canvas.refresh();
            });
        }

        let player, cursors, score = 0, scoreTxt, bots, obstacles;

        function create() {
            // HIGH QUALITY RINK RENDER
            let g = this.add.graphics();
            g.fillStyle(0xeaf9ff); g.fillRoundedRect(50, 50, window.innerWidth-100, window.innerHeight-100, 40); // Ice
            g.lineStyle(8, 0xffffff); g.strokeRoundedRect(50, 50, window.innerWidth-100, window.innerHeight-100, 40); // Boards
            
            // Markings
            g.lineStyle(5, 0xff0000, 0.5); g.lineBetween(window.innerWidth/2, 50, window.innerWidth/2, window.innerHeight-50);
            g.lineStyle(5, 0x0000ff, 0.3); 
            g.lineBetween(window.innerWidth*0.3, 50, window.innerWidth*0.3, window.innerHeight-50);
            g.lineBetween(window.innerWidth*0.7, 50, window.innerWidth*0.7, window.innerHeight-50);
            g.strokeCircle(window.innerWidth/2, window.innerHeight/2, 90);

            player = this.physics.add.sprite(window.innerWidth/2, window.innerHeight - 150, 'z_' + gameState.skin);
            player.setCollideWorldBounds(true);
            player.setDamping(true);
            player.setDrag(0.95);

            scoreTxt = this.add.text(80, 80, 'SCORE: 0', { font: 'bold 30px Orbitron', color: '#000' });
            cursors = this.input.keyboard.createCursorKeys();

            // COMPETITIVE BOTS
            bots = this.physics.add.group();
            if(activeMode === 'comp') {
                for(let i=0; i<3; i++) {
                    let b = bots.create(Phaser.Math.Between(100, 800), 200, 'z_neon').setTint(0x555555);
                    b.setCollideWorldBounds(true); b.setBounce(1); b.setVelocity(150, 150);
                }
            }

            // OBSTACLES (The "Old Version" Logic)
            obstacles = this.physics.add.group();
            this.time.addEvent({
                delay: 1200, loop: true,
                callback: () => {
                    let obs = obstacles.create(Phaser.Math.Between(100, window.innerWidth-100), -50, 'z_standard').setTint(0x000000);
                    obs.setVelocityY(250 + (score/10));
                }
            });

            this.physics.add.overlap(player, [bots, obstacles], () => {
                if(score > gameState.hi) { gameState.hi = score; save(); }
                location.reload();
            });
        }

        function update() {
            score++;
            scoreTxt.setText(activeMode.toUpperCase() + ": " + score);

            // Version 3 Precision Steering
            if (cursors.left.isDown) player.setAngularVelocity(-250);
            else if (cursors.right.isDown) player.setAngularVelocity(250);
            else player.setAngularVelocity(0);

            if (cursors.up.isDown) {
                this.physics.velocityFromRotation(player.rotation, 400, player.body.velocity);
            } else if (cursors.down.isDown) {
                this.physics.velocityFromRotation(player.rotation, -180, player.body.velocity);
            }
        }
    </script>
</body>
</html>
