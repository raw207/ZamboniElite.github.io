<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyber Zamboni: Pro Series</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #020205; overflow: hidden; font-family: 'Orbitron', sans-serif; color: white; }
        #ui-layer { position: absolute; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; z-index: 100; background: radial-gradient(circle, #0a0a20 0%, #020205 100%); }
        .panel { text-align: center; background: rgba(255, 255, 255, 0.03); padding: 40px; border: 2px solid #00ffff; border-radius: 20px; box-shadow: 0 0 30px rgba(0, 255, 255, 0.2); max-width: 600px; }
        
        h1 { font-size: 42px; margin: 0 0 10px; color: #00ffff; text-shadow: 0 0 10px #00ffff; }
        .stat-text { color: #ff0055; margin-bottom: 20px; font-weight: bold; }
        
        /* GARAGE STYLE */
        .garage-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 20px 0; }
        .skin-card { border: 1px solid #444; padding: 15px; cursor: pointer; transition: 0.3s; background: #111; position: relative; }
        .skin-card:hover { border-color: #fff; background: #222; }
        .skin-card.active { border-color: #00ff00; background: rgba(0, 255, 0, 0.1); }
        .skin-card.locked { opacity: 0.4; cursor: not-allowed; border-color: #ff0055; }
        .skin-card.locked::after { content: 'LOCKED'; position: absolute; bottom: 5px; right: 5px; font-size: 10px; color: #ff0055; }

        .btn-main { background: #00ffff; color: #000; padding: 15px 40px; border: none; font-family: 'Orbitron'; font-weight: 900; font-size: 18px; cursor: pointer; transition: 0.3s; margin-top: 20px; text-transform: uppercase; width: 100%; }
        .btn-main:hover { background: #fff; box-shadow: 0 0 20px #fff; }
        
        #game-container { width: 100%; height: 100%; display: none; }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div class="panel" id="main-menu">
            <h1>CYBER ZAMBONI</h1>
            <div class="stat-text" id="high-score-display">HIGH SCORE: 0</div>
            
            <div style="font-size: 14px; color: #aaa;">-- GARAGE / SELECT SKIN --</div>
            <div class="garage-grid" id="garage">
                </div>

            <button class="btn-main" onclick="launchGame()">Start Engine</button>
        </div>
    </div>

    <div id="game-container"></div>

    <script>
        // --- DATA SYSTEM ---
        const SKINS = [
            { id: 'red', name: 'Standard Red', color: '#ff0000', req: 0, type: 'basic' },
            { id: 'blue', name: 'Arctic Blue', color: '#00ccff', req: 0, type: 'basic' },
            { id: 'mario', name: 'Plumber Bros', color: '#ff0000', req: 500, type: 'mario' },
            { id: 'lambo', name: 'Lambo-Z', color: '#ffcc00', req: 800, type: 'lambo' }
        ];

        let save = JSON.parse(localStorage.getItem('zamboni_save_v4')) || { high: 0, skin: 'red' };

        function updateUI() {
            document.getElementById('high-score-display').innerText = `HIGH SCORE: ${save.high}`;
            const garage = document.getElementById('garage');
            garage.innerHTML = '';

            SKINS.forEach(s => {
                const isLocked = save.high < s.req;
                const isActive = save.skin === s.id;
                const card = document.createElement('div');
                card.className = `skin-card ${isLocked ? 'locked' : ''} ${isActive ? 'active' : ''}`;
                card.innerHTML = `<strong>${s.name}</strong><br><small>${isLocked ? 'Reach ' + s.req : 'Unlocked'}</small>`;
                
                if (!isLocked) {
                    card.onclick = () => {
                        save.skin = s.id;
                        localStorage.setItem('zamboni_save_v4', JSON.stringify(save));
                        updateUI();
                    };
                }
                garage.appendChild(card);
            });
        }
        updateUI();

        // --- GAME ENGINE ---
        function launchGame() {
            document.getElementById('ui-layer').style.display = 'none';
            document.getElementById('game-container').style.display = 'block';

            const config = {
                type: Phaser.AUTO,
                width: window.innerWidth,
                height: window.innerHeight,
                parent: 'game-container',
                physics: { default: 'arcade' },
                scene: { preload, create, update }
            };

            new Phaser.Game(config);
        }

        function preload() {
            // Draw Zamboni Textures
            SKINS.forEach(s => {
                let canvas = this.textures.createCanvas('z_' + s.id, 64, 40);
                let ctx = canvas.context;
                ctx.fillStyle = s.color;
                
                if (s.type === 'lambo') {
                    ctx.beginPath(); ctx.moveTo(60, 20); ctx.lineTo(15, 38); ctx.lineTo(0, 20); ctx.lineTo(15, 2); ctx.closePath(); ctx.fill();
                    ctx.fillStyle = '#000'; ctx.fillRect(15, 8, 20, 24);
                } else if (s.type === 'mario') {
                    ctx.fillRect(0, 0, 60, 40);
                    ctx.fillStyle = '#0000ff'; ctx.fillRect(10, 10, 25, 20);
                    ctx.fillStyle = '#fff'; ctx.beginPath(); ctx.arc(45, 20, 10, 0, Math.PI*2); ctx.fill();
                } else {
                    ctx.fillRect(5, 5, 50, 30);
                    ctx.fillStyle = '#111'; ctx.fillRect(45, 0, 10, 10); ctx.fillRect(45, 30, 10, 10);
                }
                canvas.refresh();
            });
        }

        let player, cursors, score = 0, scoreTxt, enemies;

        function create() {
            // HIGH DETAIL RINK
            let g = this.add.graphics();
            g.fillStyle(0xddf4ff); // Ice color
            g.fillRect(0, 0, window.innerWidth, window.innerHeight);
            
            // Rink Markings
            g.lineStyle(6, 0xff0000, 0.6); g.lineBetween(window.innerWidth/2, 0, window.innerWidth/2, window.innerHeight);
            g.lineStyle(6, 0x0000ff, 0.4); g.lineBetween(window.innerWidth*0.3, 0, window.innerWidth*0.3, window.innerHeight);
            g.lineStyle(6, 0x0000ff, 0.4); g.lineBetween(window.innerWidth*0.7, 0, window.innerWidth*0.7, window.innerHeight);
            g.strokeCircle(window.innerWidth/2, window.innerHeight/2, 100);

            player = this.physics.add.sprite(window.innerWidth/2, window.innerHeight - 100, 'z_' + save.skin);
            player.setCollideWorldBounds(true);

            enemies = this.physics.add.group();
            this.time.addEvent({
                delay: 1000,
                callback: () => {
                    let e = enemies.create(Phaser.Math.Between(50, window.innerWidth-50), -50, 'z_red');
                    e.setTint(0x000000);
                    e.setVelocityY(250 + (score/10));
                },
                loop: true
            });

            this.physics.add.overlap(player, enemies, () => {
                if (score > save.high) save.high = score;
                localStorage.setItem('zamboni_save_v4', JSON.stringify(save));
                location.reload(); 
            });

            scoreTxt = this.add.text(20, 20, 'CLEANED: 0', { font: 'bold 30px Orbitron', color: '#000' });
            cursors = this.input.keyboard.createCursorKeys();
        }

        function update() {
            score++;
            scoreTxt.setText(`CLEANED: ${score}`);

            // PRECISION MOVEMENT
            if (cursors.left.isDown) player.setAngularVelocity(-260);
            else if (cursors.right.isDown) player.setAngularVelocity(260);
            else player.setAngularVelocity(0);

            if (cursors.up.isDown) {
                this.physics.velocityFromRotation(player.rotation, 400, player.body.velocity);
            } else if (cursors.down.isDown) {
                this.physics.velocityFromRotation(player.rotation, -200, player.body.velocity);
            } else {
                player.setVelocity(0); // Instant stop - No Drift
            }
        }
    </script>
</body>
</html>
