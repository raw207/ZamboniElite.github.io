<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cyber Zamboni: Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');
        body { margin: 0; background: #050505; display: flex; justify-content: center; align-items: center; height: 100vh; font-family: 'Orbitron', sans-serif; color: #fff; overflow: hidden; }
        #game-container { position: relative; border: 4px solid #333; box-shadow: 0 0 50px #00ffff33; }
        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10; text-align: center; }
        .btn { background: #00ffff; color: #000; padding: 12px 25px; border: none; font-family: 'Orbitron'; font-weight: bold; cursor: pointer; margin: 10px; clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); transition: 0.2s; }
        .btn:hover { transform: scale(1.1); background: #fff; }
        .skin-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 15px; }
        .skin { padding: 8px; border: 1px solid #444; font-size: 10px; cursor: pointer; }
        .skin.locked { opacity: 0.3; border-color: red; }
        .skin.active { border-color: #00ff00; background: #00ff0022; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="menu" class="overlay">
        <h1 style="color:#00ffff; text-shadow: 0 0 15px #00ffff;">CYBER ZAMBONI</h1>
        <div id="stats" style="margin-bottom: 10px;">HIGH SCORE: 0</div>
        <div class="skin-grid" id="skin-list"></div>
        <button class="btn" onclick="start()">START GAME</button>
    </div>
</div>

<script>
// --- SAVE & DATA ---
let storage = JSON.parse(localStorage.getItem('zamboni_v3')) || { hi: 0, skin: 'red' };
const SKINS = [
    { id: 'red', n: 'CLASSIC', c: '#ff0000', r: 0 },
    { id: 'blue', n: 'ICE', c: '#0088ff', r: 0 },
    { id: 'mario', n: 'PLUMBER', c: '#ff0000', r: 500, spec: 'm' },
    { id: 'lambo', n: 'LAMBO-Z', c: '#ffcc00', r: 800, spec: 'l' }
];

function updateMenu() {
    document.getElementById('stats').innerText = `HIGH SCORE: ${storage.hi}`;
    const list = document.getElementById('skin-list');
    list.innerHTML = '';
    SKINS.forEach(s => {
        let lock = storage.hi < s.r;
        let div = document.createElement('div');
        div.className = `skin ${lock ? 'locked' : ''} ${storage.skin === s.id ? 'active' : ''}`;
        div.innerHTML = `${s.n}<br>${lock ? 'REQ: '+s.r : 'OWNED'}`;
        if(!lock) div.onclick = () => { storage.skin = s.id; localStorage.setItem('zamboni_v3', JSON.stringify(storage)); updateMenu(); };
        list.appendChild(div);
    });
}
updateMenu();

// --- GAME ---
function start() {
    document.getElementById('menu').style.display = 'none';
    const game = new Phaser.Game({
        type: Phaser.AUTO, width: 1000, height: 700, parent: 'game-container',
        physics: { default: 'arcade' },
        scene: { preload, create, update }
    });
}

function preload() {
    SKINS.forEach(s => {
        let canvas = this.textures.createCanvas('z_' + s.id, 64, 40);
        let ctx = canvas.context;
        ctx.fillStyle = s.c;
        if(s.spec === 'l') { // Lambo shape
            ctx.beginPath(); ctx.moveTo(60,20); ctx.lineTo(10,38); ctx.lineTo(0,20); ctx.lineTo(10,2); ctx.fill();
        } else if(s.spec === 'm') { // Mario colors
            ctx.fillRect(0,0,60,40); ctx.fillStyle="#0000ff"; ctx.fillRect(10,10,20,20);
            ctx.fillStyle="#fff"; ctx.beginPath(); ctx.arc(45,20,8,0,7); ctx.fill();
        } else {
            ctx.fillRect(5,5,50,30); ctx.fillStyle="#333"; ctx.fillRect(45,0,10,10); ctx.fillRect(45,30,10,10);
        }
        canvas.refresh();
    });
}

let player, cursors, score = 0, scoreTxt;

function create() {
    // HIGH DETAIL RINK
    let g = this.add.graphics();
    g.fillStyle(0x0a0a15); g.fillRect(0,0,1000,700);
    g.fillStyle(0xe0f7ff); g.fillRoundedRect(50,50,900,600,60);
    g.lineStyle(6, 0xffffff); g.strokeRoundedRect(50,50,900,600,60);
    g.lineStyle(4, 0xff0000, 0.5); g.lineBetween(500,50,500,650); // Red line
    g.lineStyle(4, 0x0000ff, 0.3); g.lineBetween(300,50,300,650); g.lineBetween(700,50,700,650); // Blue lines
    g.strokeCircle(500, 350, 70);

    player = this.physics.add.sprite(500, 350, 'z_' + storage.skin);
    player.setCollideWorldBounds(true);
    
    scoreTxt = this.add.text(70, 70, 'CLEANED: 0', { font: 'bold 24px Orbitron', color: '#000' });
    cursors = this.input.keyboard
