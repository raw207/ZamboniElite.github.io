<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cyber Zamboni: Pro Series</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        body { margin: 0; background: #020205; font-family: 'Orbitron', sans-serif; color: white; overflow: hidden; }
        #menu-layer { position: absolute; width: 100%; height: 100%; z-index: 100; background: radial-gradient(circle, #0a0a25 0%, #000 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; }
        
        .main-title { font-size: 55px; color: #00ffff; text-shadow: 0 0 20px #00ffff; margin-bottom: 10px; font-weight: 900; }
        .score-board { color: #ff0055; font-size: 18px; margin-bottom: 30px; letter-spacing: 2px; }

        .menu-options { display: flex; flex-direction: column; gap: 10px; width: 320px; }
        .btn { background: rgba(0, 255, 255, 0.1); border: 2px solid #00ffff; color: #00ffff; padding: 15px; cursor: pointer; font-family: 'Orbitron'; font-weight: 700; transition: 0.3s; text-transform: uppercase; text-align: center; }
        .btn:hover { background: #00ffff; color: #000; box-shadow: 0 0 25px #00ffff; }

        /* Garage Styles */
        #garage-overlay { display: none; position: absolute; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 110; flex-direction: column; align-items: center; justify-content: center; }
        .skin-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 20px; }
        .skin-item { border: 2px solid #444; padding: 20px; width: 150px; text-align: center; cursor: pointer; background: #111; }
        .skin-item.locked { opacity: 0.3; border-color: #ff0055; cursor: not-allowed; }
        .skin-item.selected { border-color: #00ff00; background: rgba(0,255,0,0.1); }
        
        #game-container { width: 100vw; height: 100vh; }
    </style>
</head>
<body>

    <div id="menu-layer">
        <div class="main-title">ZAMBONI PRO</div>
        <div class="score-board">GLOBAL HIGH SCORE: <span id="hi-val">0</span></div>
        
        <div class="menu-options">
            <div class="btn" onclick="startMode('story')">Story Mode</div>
            <div class="btn" onclick="startMode('endless')">Endless Mode</div>
            <div class="btn" onclick="startMode('comp')">Competitive (Vs Bots)</div>
            <div class="btn" onclick="toggleGarage(true)">Customize Garage</div>
        </div>
    </div>

    <div id="garage-overlay">
        <h1>GARAGE</h1>
        <div class="skin-grid" id="skin-list"></div>
        <div class="btn" style="margin-top: 40px; width: 200px;" onclick="toggleGarage(false)">BACK</div>
    </div>

    <div id="game-container"></div>

    <script>
        let gameState = JSON.parse(localStorage.getItem('zamboni_pro_save')) || { hi: 0, skin: 'standard' };
        let activeMode = 'endless';

        const SKINS = [
            { id: 'standard', name: 'Classic Red', color: '#ff0000', req: 0, special: 'none' },
            { id: 'neon', name: 'Neon Blue', color: '#00ffff', req: 0, special: 'none' },
            { id: 'mario', name: 'M-Bros Plumber', color: '#ff0000', req: 500, special: 'mario' },
            { id: 'lambo', name: 'Lambo-Z', color: '#ffcc00', req: 800, special: 'lambo' }
        ];

        function toggleGarage(show) {
            const g = document.getElementById('garage-overlay');
            g.style.display = show ? 'flex' : 'none';
            if(show) renderSkins();
        }

        function renderSkins() {
            const list = document.getElementById('skin-list');
            list.innerHTML = '';
            document.getElementById('hi-val').innerText = gameState.hi;
            
            SKINS.forEach(s => {
                const locked = gameState.hi < s.req;
                const div = document.createElement('div');
                div.className = `skin-item ${locked ? 'locked' : ''} ${gameState.skin === s.id ? 'selected' : ''}`;
                div.innerHTML = `<strong>${s.name}</strong><br>${locked ? 'REQ: ' + s.req : 'OWNED'}`;
                if(!locked) {
                    div.onclick = () => { gameState.skin = s.id; save(); renderSkins(); };
                }
                list.appendChild(div);
            });
        }

        function save() { localStorage.setItem('zamboni_pro_save', JSON.stringify(gameState)); }

        function startMode(mode) {
            activeMode = mode;
            document.getElementById('menu-layer').style.display = 'none';
            initGame();
        }

        // --- PHASER GAME ENGINE ---
        function initGame() {
            const config = {
                type: Phaser.AUTO,
                width: window.innerWidth,
                height: window.innerHeight,
                parent: 'game-container',
                physics: { default: 'arcade', arcade: { gravity: { y: 0 } } },
                scene: { preload, create, update }
            };
            new Phaser.Game(config);
        }

        function preload() {
            SKINS.forEach(s => {
                let canvas = this.textures.createCanvas('z_' + s.id, 70, 45);
                let ctx = canvas.context;
                ctx.fillStyle = s.color;
                if(s.special === 'lambo') {
                    ctx.beginPath(); ctx.moveTo(70, 22); ctx.lineTo(15, 43); ctx.lineTo(0, 22); ctx.lineTo(15, 7); ctx.fill();
                    ctx.fillStyle = '#111'; ctx.fillRect(20, 12, 25, 20);
                } else if(s.special === 'mario') {
                    ctx.fillRect(5, 5, 60, 35); ctx.fillStyle = '#0000ff'; ctx.fillRect(10, 10, 30, 25);
                    ctx.fillStyle = '#fff'; ctx.beginPath(); ctx.arc(50, 22, 10, 0, 7); ctx.fill();
                } else {
                    ctx.fillRect(10, 5, 50, 35); ctx.fillStyle = '#333'; ctx.fillRect(55, 0, 12, 10); ctx.fillRect(55, 35, 12, 10);
                }
                canvas.refresh();
            });
        }

        let player, cursors, score = 0, scoreTxt, enemies, bots;

        function create() {
            // HIGH QUALITY RINK RENDERING
            let bg = this.add.graphics();
            bg.fillStyle(0x050510); bg.fillRect(0, 0, window.innerWidth, window.innerHeight); // Sub-floor
            bg.fillStyle(0xe5f9ff); bg.fillRoundedRect(40, 40, window.innerWidth-80, window.innerHeight-80, 50); // High-res Ice
            bg.lineStyle(8, 0xffffff); bg.strokeRoundedRect(40, 40, window.innerWidth-80, window.innerHeight-80, 50); // Boards
            
            // Markings
            bg.lineStyle(5, 0xff0000, 0.5); bg.lineBetween(window.innerWidth/2, 40, window.innerWidth/2, window.innerHeight-40);
            bg.lineStyle(5, 0x0000ff, 0.3); 
            bg.lineBetween(window.innerWidth*0.35, 40, window.innerWidth*0.35, window.innerHeight-40);
            bg.lineBetween(window.innerWidth*0.65, 40, window.innerWidth*0.65, window.innerHeight-40);
            bg.strokeCircle(window.innerWidth/2, window.innerHeight/2, 100);

            player = this.physics.add.sprite(window.innerWidth/2, window.innerHeight - 150, 'z_' + gameState.skin);
            player.setCollideWorldBounds(true);

            scoreTxt = this.add.text(60, 60, 'SCORE: 0', { font: 'bold 32px Orbitron', color: '#000' });

            // COMPETITIVE MODE BOTS
            bots = this.physics.add.group();
            if(activeMode === 'comp') {
                for(let i=0; i<3; i++) {
                    let bot = bots.create(Phaser.Math.Between(100, 800), 200, 'z_neon').setTint(0xaaaaaa);
                    bot.setVelocity(100, 100); bot.setBounce(1); bot.setCollideWorldBounds(true);
                }
            }

            enemies = this.physics.add.group();
            this.time.addEvent({
                delay: 1000, loop: true,
                callback: () => {
                    let x = Phaser.Math.Between(100, window.innerWidth-100);
                    let e = enemies.create(x, -50, 'z_standard').setTint(0x000000).setScale(0.8);
                    e.setVelocityY(200 + (score/5));
                }
            });

            this.physics.add.overlap(player, enemies, gameOver, null, this);
            this.physics.add.overlap(player, bots, gameOver, null, this);
            cursors = this.input.keyboard.createCursorKeys();
        }

        function gameOver() {
            if(score > gameState.hi) { gameState.hi = score; save(); }
            location.reload();
        }

        function update() {
            score++;
            scoreTxt.setText(`${activeMode.toUpperCase()} SCORE: ${score}`);

            // FREER MOVEMENT (Rotation based + Precision Traction)
            if (cursors.left.isDown) player.setAngularVelocity(-280);
            else if (cursors.right.isDown) player.setAngularVelocity(280);
            else player.setAngularVelocity(0);

            if (cursors.up.isDown) {
                this.physics.velocityFromRotation(player.rotation, 450, player.body.velocity);
            } else if (cursors.down.isDown) {
                this.physics.velocityFromRotation(player.rotation, -200, player.body.velocity);
            } else {
                player.setVelocity(0); // High-traction Stop
            }

            // Simple Bot AI for Comp Mode
            bots.children.iterate(bot => {
                if(bot) {
                    if(Phaser.Math.Between(0, 100) > 95) {
                        this.physics.moveToObject(bot, player, 150);
                    }
                }
            });
        }
    </script>
</body>
</html>
