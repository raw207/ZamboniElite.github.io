<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cyber Zamboni: Skull Survival</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Press+Start+2P&display=swap');
        body { margin: 0; background: #000; font-family: 'Orbitron', sans-serif; overflow: hidden; color: white; }
        #ui-layer { position: absolute; width: 100%; height: 100%; z-index: 100; background: rgba(0,0,10,0.9); display: flex; align-items: center; justify-content: center; }
        .menu-box { text-align: center; background: #050510; padding: 40px; border: 3px solid #00ffff; border-radius: 15px; box-shadow: 0 0 40px #00ffff55; width: 450px; }
        h1 { font-size: 32px; color: #ff0055; text-shadow: 0 0 10px #ff0055; font-family: 'Press Start 2P'; margin-bottom: 30px; }
        .btn { background: #111; border: 1px solid #00ffff; color: #00ffff; padding: 12px; margin: 8px 0; width: 100%; cursor: pointer; font-family: 'Orbitron'; font-weight: 900; transition: 0.2s; }
        .btn:hover { background: #00ffff; color: #000; box-shadow: 0 0 20px #00ffff; }
        
        .garage-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        .skin-btn { border: 1px solid #444; padding: 10px; font-size: 10px; cursor: pointer; background: #000; }
        .skin-btn.locked { color: #555; border-color: #333; }
        .skin-btn.selected { border-color: #00ff00; background: #00ff0022; }
        
        #game-container { width: 100vw; height: 100vh; display: none; }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div class="menu-box" id="main-menu">
            <h1>SKULL RUN</h1>
            <p id="hi-score" style="color:#00ffff">MAX SURVIVAL: 0</p>
            <button class="btn" onclick="startMode('story')">STORY MODE (CH 1)</button>
            <button class="btn" onclick="startMode('endless')">ENDLESS SURVIVAL</button>
            <button class="btn" onclick="startMode('comp')">COMPETITIVE BOTS</button>
            <button class="btn" onclick="showGarage()">GARAGE / SKINS</button>
        </div>

        <div class="menu-box" id="garage-menu" style="display:none;">
            <h1 style="font-size: 20px;">CHOOSE YOUR RIG</h1>
            <div class="garage-grid" id="skin-list"></div>
            <button class="btn" onclick="showMain()">BACK</button>
        </div>
    </div>

    <div id="game-container"></div>

    <script>
    let save = JSON.parse(localStorage.getItem('z_skull_v1')) || { hi: 0, skin: 'red' };
    let currentMode = 'endless';

    const SKINS = [
        { id: 'red', name: 'BASIC RED', color: 0xff0000, req: 0, type: 'basic' },
        { id: 'blue', name: 'NEON BLUE', color: 0x00ffff, req: 0, type: 'basic' },
        { id: 'mario', name: 'MARIO RIG', color: 0xff0000, req: 500, type: 'mario' },
        { id: 'lambo', name: 'LAMBO-Z', color: 0xffcc00, req: 800, type: 'lambo' }
    ];

    function showGarage() {
        document.getElementById('main-menu').style.display = 'none';
        document.getElementById('garage-menu').style.display = 'block';
        const list = document.getElementById('skin-list');
        list.innerHTML = '';
        SKINS.forEach(s => {
            const locked = save.hi < s.req;
            const div = document.createElement('div');
            div.className = `skin-btn ${locked ? 'locked' : ''} ${save.skin === s.id ? 'selected' : ''}`;
            div.innerHTML = `<strong>${s.name}</strong><br>${locked ? 'REQ: '+s.req : 'EQUIP'}`;
            if(!locked) div.onclick = () => { save.skin = s.id; localStorage.setItem('z_skull_v1', JSON.stringify(save)); showGarage(); };
            list.appendChild(div);
        });
    }

    function showMain() {
        document.getElementById('garage-menu').style.display = 'none';
        document.getElementById('main-menu').style.display = 'block';
        document.getElementById('hi-score').innerText = "MAX SURVIVAL: " + save.hi;
    }
    showMain();

    function startMode(mode) {
        currentMode = mode;
        document.getElementById('ui-layer').style.display = 'none';
        document.getElementById('game-container').style.display = 'block';
        const game = new Phaser.Game({
            type: Phaser.AUTO, width: 1000, height: 700, parent: 'game-container',
            physics: { default: 'arcade' }, scene: { preload, create, update }
        });
    }

    function preload() {
        // Draw Zamboni
        SKINS.forEach(s => {
            let canvas = this.textures.createCanvas('z_' + s.id, 64, 40);
            let ctx = canvas.context;
            ctx.fillStyle = '#' + s.color.toString(16).padStart(6, '0');
            if(s.type === 'lambo') {
                ctx.beginPath(); ctx.moveTo(64,20); ctx.lineTo(10,40); ctx.lineTo(0,20); ctx.lineTo(10,0); ctx.fill();
            } else if(s.type === 'mario') {
                ctx.fillRect(0,0,60,40); ctx.fillStyle = '#0000ff'; ctx.fillRect(0,10,25,20);
                ctx.fillStyle = '#ffffff'; ctx.beginPath(); ctx.arc(45,20,8,0,7); ctx.fill();
            } else {
                ctx.fillRect(5,5,50,30); ctx.fillStyle = '#222'; ctx.fillRect(45,0,10,10); ctx.fillRect(45,30,10,10);
            }
            canvas.refresh();
        });

        // DRAW 8-BIT SKULL
        let sk = this.textures.createCanvas('skull', 40, 40);
        let sCtx = sk.context;
        sCtx.fillStyle = '#ffffff';
        sCtx.fillRect(10,0,20,10); sCtx.fillRect(5,10,30,20); sCtx.fillRect(10,30,20,10);
        sCtx.fillStyle = '#000000'; sCtx.fillRect(10,15,5,5); sCtx.fillRect(25,15,5,5); // Eyes
        sk.refresh();
    }

    let player, skull, cursors, score = 0, scoreTxt, safeZone, bots;

    function create() {
        // HQ CLASSIC RINK
        let g = this.add.graphics();
        g.fillStyle(0xd0e8ff); g.fillRoundedRect(50,50,900,600,50); 
        g.lineStyle(6, 0xffffff); g.strokeRoundedRect(50,50,900,600,50);
        g.lineStyle(4, 0xff0000, 0.4); g.lineBetween(500,50,500,650);
        g.lineStyle(4, 0x0000ff, 0.2); g.lineBetween(350,50,350,650); g.lineBetween(650,50,650,650);

        // SAFE ZONE (Green square)
        safeZone = this.add.rectangle(850, 100, 120, 120, 0x00ff00, 0.3);
        this.physics.add.existing(safeZone, true);

        player = this.physics.add.sprite(500, 600, 'z_' + save.skin);
        player.setCollideWorldBounds(true);

        skull = this.physics.add.sprite(100, 100, 'skull');
        skull.setTint(0xff0000);

        scoreTxt = this.add.text(70, 70, 'SURVIVED: 0', { font: 'bold 24px Orbitron', color: '#000' });
        cursors = this.input.keyboard.createCursorKeys();

        // COMP BOTS
        bots = this.physics.add.group();
        if(currentMode === 'comp') {
            for(let i=0; i<2; i++){
                let b = bots.create(400, 300, 'z_blue').setTint(0x444444);
                b.setCollideWorldBounds(true); b.setBounce(1); b.setVelocity(100, 100);
            }
        }

        // DEATH LOGIC
        this.physics.add.overlap(player, skull, () => {
            // Check if inside safe zone
            let boundsA = player.getBounds();
            let boundsB = safeZone.getBounds();
            if(!Phaser.Geom.Intersects.RectangleToRectangle(boundsA, boundsB)) {
                if(score > save.hi) save.hi = score;
                localStorage.setItem('z_skull_v1', JSON.stringify(save));
                location.reload();
            }
        });
    }

    function update() {
        score++;
        scoreTxt.setText("SCORE: " + score);

        // Skull AI: Chases player constantly
        this.physics.moveToObject(skull, player, 160 + (score/20));

        // Randomize Safe Zone position every 500 points
        if(score % 500 === 0) {
            safeZone.x = Phaser.Math.Between(150, 850);
            safeZone.y = Phaser.Math.Between(150, 550);
        }

        // MOVEMENT
        if (cursors.left.isDown) player.setAngularVelocity(-260);
        else if (cursors.right.isDown) player.setAngularVelocity(260);
        else player.setAngularVelocity(0);

        if (cursors.up.isDown) this.physics.velocityFromRotation(player.rotation, 380, player.body.velocity);
        else if (cursors.down.isDown) this.physics.velocityFromRotation(player.rotation, -150, player.body.velocity);
        else player.setVelocity(0);
    }
    </script>
</body>
</html>
