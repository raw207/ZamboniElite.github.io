<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Zamboni: Orb Hunter</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Press+Start+2P&display=swap');
        body { margin: 0; background: #000; font-family: 'Orbitron', sans-serif; overflow: hidden; color: white; }
        #ui-layer { position: absolute; width: 100%; height: 100%; z-index: 100; background: rgba(0,0,10,0.95); display: flex; align-items: center; justify-content: center; }
        .menu-box { text-align: center; background: #050510; padding: 40px; border: 3px solid #00ffff; border-radius: 15px; box-shadow: 0 0 40px #00ffff55; width: 450px; }
        h1 { font-size: 28px; color: #00ffff; text-shadow: 0 0 10px #00ffff; font-family: 'Press Start 2P'; margin-bottom: 30px; }
        .btn { background: #111; border: 1px solid #00ffff; color: #00ffff; padding: 12px; margin: 8px 0; width: 100%; cursor: pointer; font-family: 'Orbitron'; font-weight: 900; transition: 0.2s; }
        .btn:hover { background: #00ffff; color: #000; box-shadow: 0 0 20px #00ffff; }
        .garage-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        .skin-btn { border: 1px solid #444; padding: 10px; font-size: 10px; cursor: pointer; background: #000; }
        .skin-btn.locked { color: #555; }
        .skin-btn.selected { border-color: #00ff00; background: #00ff0022; }
        #game-container { width: 100vw; height: 100vh; display: none; }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div class="menu-box" id="main-menu">
            <h1>ORB HUNTER</h1>
            <p id="hi-score" style="color:#00ffff">MAX ORBS: 0</p>
            <button class="btn" onclick="startMode('story')">STORY MODE</button>
            <button class="btn" onclick="startMode('endless')">ENDLESS MODE</button>
            <button class="btn" onclick="startMode('comp')">COMPETITIVE</button>
            <button class="btn" onclick="showGarage()">CUSTOMIZE</button>
        </div>

        <div class="menu-box" id="garage-menu" style="display:none;">
            <h1>GARAGE</h1>
            <div class="garage-grid" id="skin-list"></div>
            <button class="btn" onclick="showMain()">BACK</button>
        </div>
    </div>

    <div id="game-container"></div>

    <script>
    let save = JSON.parse(localStorage.getItem('z_orb_v1')) || { hi: 0, skin: 'red' };
    let currentMode = 'endless';

    const SKINS = [
        { id: 'red', name: 'BASIC RED', color: 0xff0000, req: 0 },
        { id: 'blue', name: 'NEON BLUE', color: 0x00ffff, req: 0 },
        { id: 'mario', name: 'MARIO RIG', color: 0xff0000, req: 20 }, // 20 orbs
        { id: 'lambo', name: 'LAMBO-Z', color: 0xffcc00, req: 50 }   // 50 orbs
    ];

    function showGarage() {
        document.getElementById('main-menu').style.display = 'none';
        document.getElementById('garage-menu').style.display = 'block';
        const list = document.getElementById('skin-list');
        list.innerHTML = '';
        SKINS.forEach(s => {
            const locked = save.hi < s.req;
            const div = document.createElement('div');
            div.className = `skin-btn ${locked ? 'locked' : ''} ${save.skin === s.id ? 'selected' : ''}`;
            div.innerHTML = `<strong>${s.name}</strong><br>${locked ? 'REQ: '+s.req+' ORBS' : 'EQUIP'}`;
            if(!locked) div.onclick = () => { save.skin = s.id; localStorage.setItem('z_orb_v1', JSON.stringify(save)); showGarage(); };
            list.appendChild(div);
        });
    }

    function showMain() {
        document.getElementById('garage-menu').style.display = 'none';
        document.getElementById('main-menu').style.display = 'block';
        document.getElementById('hi-score').innerText = "MAX ORBS COLLECTED: " + save.hi;
    }
    showMain();

    function startMode(mode) {
        currentMode = mode;
        document.getElementById('ui-layer').style.display = 'none';
        document.getElementById('game-container').style.display = 'block';
        new Phaser.Game({
            type: Phaser.AUTO, width: 1000, height: 700, parent: 'game-container',
            physics: { default: 'arcade' }, scene: { preload, create, update }
        });
    }

    function preload() {
        SKINS.forEach(s => {
            let canvas = this.textures.createCanvas('z_' + s.id, 60, 35);
            let ctx = canvas.context;
            ctx.fillStyle = '#' + s.color.toString(16).padStart(6, '0');
            ctx.fillRect(0,0,60,35);
            canvas.refresh();
        });

        // 8-BIT SKULL
        let sk = this.textures.createCanvas('skull', 40, 40);
        let sCtx = sk.context;
        sCtx.fillStyle = '#ffffff'; sCtx.fillRect(10,0,20,10); sCtx.fillRect(5,10,30,20); sCtx.fillRect(10,30,20,10);
        sCtx.fillStyle = '#000000'; sCtx.fillRect(10,15,5,5); sCtx.fillRect(25,15,5,5);
        sk.refresh();

        // ORB
        let orb = this.textures.createCanvas('orb', 20, 20);
        let oCtx = orb.context;
        oCtx.fillStyle = '#ffff00'; oCtx.beginPath(); oCtx.arc(10,10,8,0,7); oCtx.fill();
        orb.refresh();
    }

    let player, skull, orbs, cursors, score = 0, scoreTxt, safeZone, bots;

    function create() {
        // HQ ICE RINK
        let g = this.add.graphics();
        g.fillStyle(0xe0f7ff); g.fillRoundedRect(50,50,900,600,50); 
        g.lineStyle(6, 0xffffff); g.strokeRoundedRect(50,50,900,600,50);

        safeZone = this.add.rectangle(500, 350, 150, 150, 0x00ff00, 0.2);
        this.physics.add.existing(safeZone, true);

        player = this.physics.add.sprite(500, 600, 'z_' + save.skin);
        player.setCollideWorldBounds(true);

        skull = this.physics.add.sprite(100, 100, 'skull').setTint(0xff0000);
        
        orbs = this.physics.add.group();
        spawnOrb();

        scoreTxt = this.add.text(70, 70, 'ORBS: 0', { font: 'bold 24px Orbitron', color: '#000' });
        cursors = this.input.keyboard.createCursorKeys();

        // ORB COLLECTION
        this.physics.add.overlap(player, orbs, (p, o) => {
            o.destroy();
            score++;
            scoreTxt.setText("ORBS: " + score);
            spawnOrb();
        });

        // SKULL DEATH
        this.physics.add.overlap(player, skull, () => {
            let inSafe = Phaser.Geom.Intersects.RectangleToRectangle(player.getBounds(), safeZone.getBounds());
            if(!inSafe) {
                if(score > save.hi) save.hi = score;
                localStorage.setItem('z_orb_v1', JSON.stringify(save));
                location.reload();
            }
        });

        // COMP BOTS
        bots = this.physics.add.group();
        if(currentMode === 'comp') {
            for(let i=0; i<2; i++) {
                let b = bots.create(Phaser.Math.Between(100,900), 200, 'z_blue').setTint(0x666666);
                b.setCollideWorldBounds(true); b.setBounce(1); b.setVelocity(100, 100);
            }
        }
    }

    function spawnOrb() {
        orbs.create(Phaser.Math.Between(100, 900), Phaser.Math.Between(100, 600), 'orb');
    }

    function update() {
        this.physics.moveToObject(skull, player, 140 + (score * 5));

        if (cursors.left.isDown) player.setAngularVelocity(-300);
        else if (cursors.right.isDown) player.setAngularVelocity(300);
        else player.setAngularVelocity(0);

        if (cursors.up.isDown) this.physics.velocityFromRotation(player.rotation, 400, player.body.velocity);
        else if (cursors.down.isDown) this.physics.velocityFromRotation(player.rotation, -200, player.body.velocity);
        else player.setVelocity(0);
    }
    </script>
</body>
</html>
