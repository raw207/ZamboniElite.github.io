<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyber Zamboni - GitHub Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        body { margin: 0; background: #000; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; font-family: sans-serif; }
        canvas { border: 4px solid #444; }
    </style>
</head>
<body>
    <script>
    // --- SCENE 1: MAIN MENU ---
    class MenuScene extends Phaser.Scene {
        constructor() { super('MenuScene'); }
        create() {
            this.add.text(400, 150, 'CYBER ZAMBONI', { fontSize: '64px', fill: '#00ffff', fontStyle: 'bold' }).setOrigin(0.5);
            
            const btn = (y, txt, clr, mode) => {
                let b = this.add.text(400, y, txt, { fontSize: '32px', fill: '#fff', backgroundColor: clr, padding: 15 })
                    .setOrigin(0.5).setInteractive({ useHandCursor: true })
                    .on('pointerdown', () => this.scene.start('GameScene', { mode: mode }));
                b.on('pointerover', () => b.setAlpha(0.8));
                b.on('pointerout', () => b.setAlpha(1));
            };

            btn(300, ' STORY MODE ', '#800080', 'story');
            btn(420, ' ENDLESS MODE ', '#006666', 'endless');
        }
    }

    // --- SCENE 2: GAMEPLAY ---
    class GameScene extends Phaser.Scene {
        constructor() { super('GameScene'); }

        init(data) {
            this.mode = data.mode || 'endless';
            this.level = 1;
            this.score = 0;
            this.isDead = false;
        }

        preload() {
            // Programmatically generating textures so you don't need to upload image files to GitHub
            let z = this.textures.createCanvas('zamboni', 40, 30);
            z.context.fillStyle = '#ff0000'; z.context.fillRect(2, 2, 36, 26);
            z.context.fillStyle = '#ffffff'; z.context.fillRect(28, 8, 6, 14);
            z.refresh();

            let s = this.textures.createCanvas('skull', 32, 32);
            s.context.fillStyle = '#ffffff'; s.context.fillRect(8, 4, 16, 20);
            s.context.fillStyle = '#000'; s.context.fillRect(10, 10, 4, 6); s.context.fillRect(18, 10, 4, 6);
            s.refresh();
        }

        create() {
            this.setupRink();
            
            // Safe Zone (Center)
            this.safeZone = this.add.rectangle(400, 300, 120, 120, 0x00ffff, 0.15);
            this.safeZone.setStrokeStyle(2, 0x00ffff);
            this.physics.add.existing(this.safeZone, true);

            this.pucks = this.physics.add.group();
            this.spawnPucks();

            this.player = this.physics.add.sprite(400, 450, 'zamboni');
            this.skulls = this.physics.add.group();
            this.skulls.create(400, 100, 'skull').setScale(1.8);
            
            this.physics.add.collider(this.player, this.walls);
            this.physics.add.collider(this.skulls, this.walls);
            this.physics.add.collider(this.skulls, this.safeZone);

            this.scoreText = this.add.text(20, 20, 'SCORE: 0', { fontSize: '24px', fill: '#00ffff', stroke: '#000', strokeThickness: 4 });
            
            this.physics.add.overlap(this.player, this.pucks, (p, puck) => {
                puck.destroy();
                this.score += 10;
                this.scoreText.setText('SCORE: ' + this.score);
                this.handleLeveling();
                if(this.pucks.countActive(true) === 0) this.spawnPucks();
            });

            this.physics.add.overlap(this.player, this.skulls, this.gameOver, null, this);
            this.cursors = this.input.keyboard.createCursorKeys();
        }

        setupRink() {
            this.cameras.main.setBackgroundColor('#0a0a12');
            let graphics = this.add.graphics();
            graphics.lineStyle(2, 0xffffff, 0.2);
            graphics.strokeCircle(400, 300, 80);
            graphics.strokeRect(350, 15, 100, 40); // Crease Top
            graphics.strokeRect(350, 545, 100, 40); // Crease Bottom

            this.walls = this.physics.add.staticGroup();
            const drawWall = (x, y, w, h) => {
                let b = this.add.rectangle(x, y, w, h, 0x111111);
                b.setStrokeStyle(3, 0xbc00ff);
                this.walls.add(b);
            };
            drawWall(400, 10, 800, 20); drawWall(400, 590, 800, 20);
            drawWall(10, 300, 20, 600); drawWall(790, 300, 20, 600);
        }

        handleLeveling() {
            if (this.mode !== 'story') return;
            if (this.score === 100) this.cameras.main.setBackgroundColor('#1a0505');
            if (this.score === 300) {
                this.cameras.main.setBackgroundColor('#330000');
                let s2 = this.skulls.create(100, 100, 'skull').setScale(1.8).setTint(0xff0000);
            }
        }

        spawnPucks() {
            for(let i=0; i<10; i++) {
                let p = this.add.circle(Phaser.Math.Between(50, 750), Phaser.Math.Between(50, 550), 6, 0xffffff);
                p.setStrokeStyle(4, 0x00ffff);
                this.pucks.add(p);
            }
        }

        gameOver() {
            if (this.isDead) return;
            this.isDead = true;
            this.physics.pause();
            
            this.add.rectangle(400, 300, 800, 600, 0x000000, 0.85);
            this.add.text(400, 250, 'GAME OVER', { fontSize: '64px', fill: '#f00', fontStyle: 'bold' }).setOrigin(0.5);
            this.add.text(400, 350, 'ANY KEY OR CLICK TO RESTART', { fontSize: '24px', fill: '#fff' }).setOrigin(0.5);

            // BROWSER-LEVEL RESTART (GitHub Compatible)
            const reset = () => {
                window.removeEventListener('keydown', reset);
                window.removeEventListener('mousedown', reset);
                this.scene.start('GameScene', { mode: this.mode });
            };
            window.addEventListener('keydown', reset);
            window.addEventListener('mousedown', reset);
        }

        update() {
            if (this.isDead) return;
            this.player.body.setVelocity(0);
            const speed = 320;
            if (this.cursors.left.isDown) this.player.body.setVelocityX(-speed);
            else if (this.cursors.right.isDown) this.player.body.setVelocityX(speed);
            if (this.cursors.up.isDown) this.player.body.setVelocityY(-speed);
            else if (this.cursors.down.isDown) this.player.body.setVelocityY(speed);

            this.skulls.getChildren().forEach(s => {
                this.physics.moveToObject(s, this.player, 165 + (this.score * 0.15));
            });
            this.physics.world.wrap(this.player, 25);
        }
    }

    const config = {
        type: Phaser.AUTO,
        width: 800,
        height: 600,
        parent: 'game-container',
        physics: { default: 'arcade', arcade: { gravity: { y: 0 } } },
        scene: [MenuScene, GameScene]
    };
    new Phaser.Game(config);
    </script>
</body>
</html>

